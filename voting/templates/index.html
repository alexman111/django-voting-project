<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>

    <div class="container mt-4">

    <ul class="nav nav-pills">
  <li class="nav-item">
      {% url 'home' as url_home %}
    <a class="nav-link {% if url_home == request.path %} active{% endif %}" href="{{ url_home }}">Главная</a>
  </li>

    {% if request.user.username == "admin" %}
  <li class="nav-item">
      {% url 'edit_page' as url_edit %}
    <a class="nav-link {% if url_edit == request.path %} active{% endif %}" href="{{ url_edit }}">Создание/редактирование/удаление</a>
  </li>
    {% endif %}

        {% if request.user.is_authenticated == False %}
        <li class="nav-item">
      {% url 'login_page' as url_login %}
    <a class="nav-link {% if url_login == request.path %} active{% endif %}" href="{{ url_login }}">Войти</a>
  </li>
    <li class="nav-item">
      {% url 'register_page' as url_register %}
    <a class="nav-link {% if url_register == request.path %} active{% endif %}" href="{{ url_register }}">Регистрация</a>
  </li>
    {% endif %}

    {% if request.user.is_authenticated %}
    <li class="nav-item">
        {% url 'logout_page' as url_logout_page %}

        <a class="nav-link btn-danger ml-4" href="{{ url_logout_page }}">Выйти {{ request.user }}</a>
    </li>
    {% endif %}
</ul>
    {% block content %}
      <table class="table table-bordered mt-4">
  <thead>
    <tr>
      <th scope="col">Голоса</th>
      <th scope="col">Имя</th>
      <th scope="col">Фамилия</th>
      <th scope="col">Страница кандидата</th>
      <th scope="col">Проголосовать</th>

    </tr>
  </thead>
  <tbody>
    {% for candidate in candidates %}

    <tr>
      <th>{{ candidate.votes }}</th>
      <td>{{ candidate.name}}</td>
      <td>{{ candidate.surname}}</td>
      <td><a href="/candidate/{{ candidate.id }}">информация</a></td>
      <td><button id="vote_button" onclick="voteForCandidate({{ candidate.id }})"
      type="button" class="btn btn-success">Голосовать</button></td>

    </tr>
  {% endfor %}
  </tbody>
</table>
    {% endblock %}



    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
  </body>


 {% block javascript %}
        <script>
        function voteForCandidate(candidate_id) {
            $.ajax({
                url: '{% url 'vote_for_candidate' %}',
                data: {'candidate_id': candidate_id},
                dataType: 'json',

                success: function (data) {
                    if (!data.success) {
                    alert("Вы можете проголосовать только за одного кандидата!");
                  }
                    if (data.success) {
                        alert("Ваш голос принят! Для его отображения обновите страницу!")
                    }
                }

             });
        }
        </script>
    {% endblock %}
</html>

